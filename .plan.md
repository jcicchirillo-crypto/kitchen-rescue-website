# Fix NOT_FOUND Error and PDF Attachment Issues

## Problems Identified

1. **NOT_FOUND Error**: When referral code is checked, there's likely a broken link in the email pointing to a non-existent page (e.g., `/ref/KR-XXXX` or similar)
2. **PDF Not Attaching**: Puppeteer/Chromium is failing silently on Vercel, causing `pdfBuffer = null`

## Solution

### Fix 1: Remove Broken Referral Link
- Find where referral code is displayed in email HTML
- Replace any clickable links with plain text or link to real page (`client-info.html?ref=CODE`)
- This will stop the NOT_FOUND error

### Fix 2: Replace Puppeteer with pdf-lib
- Remove Puppeteer/Chromium dependencies (unreliable on Vercel)
- Install `pdf-lib` (lightweight, works 100% on Vercel)
- Rewrite `buildClientQuotePdf.js` to use pdf-lib instead of Puppeteer
- Keep same function signature and return format (pdfBuffer)

## Implementation Steps

1. **Fix email HTML** - Remove/replace broken referral code link
2. **Uninstall Puppeteer packages** - Remove puppeteer-core and chromium packages
3. **Install pdf-lib** - Lightweight PDF generation library
4. **Rewrite PDF builder** - Use pdf-lib to generate PDF programmatically
5. **Test** - Verify PDF attaches and no NOT_FOUND errors

## Files to Modify

1. `api/server.js` - Fix referral code link in email HTML
2. `api/lib/buildClientQuotePdf.js` - Complete rewrite using pdf-lib
3. `package.json` - Update dependencies
